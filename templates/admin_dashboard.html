{% extends "base.html" %}

{% block content %}
<style>
    .dashboard-header {
        animation: slideInDown 0.6s ease;
        margin-bottom: 2.5rem;
    }

    .dashboard-header h1 {
        font-size: 2.5rem;
        font-weight: 800;
        background: linear-gradient(135deg, #6366f1 0%, #10b981 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2.5rem;
    }

    .stat-card {
        background: white;
        border-radius: 15px;
        padding: 2rem;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        animation: slideInUp 0.6s ease backwards;
    }

    .stat-card:nth-child(1) { animation-delay: 0.1s; }
    .stat-card:nth-child(2) { animation-delay: 0.2s; }

    .stat-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 12px 30px rgba(99, 102, 241, 0.25);
    }

    .stat-card h5 {
        color: #64748b;
        font-weight: 600;
        font-size: 0.95rem;
        margin-bottom: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .stat-number {
        font-size: 2.5rem;
        font-weight: 800;
        background: linear-gradient(135deg, #6366f1 0%, #10b981 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .section-title {
        font-size: 1.8rem;
        font-weight: 800;
        color: #1e293b;
        margin-bottom: 1.5rem;
        margin-top: 2rem;
        padding-bottom: 1rem;
        border-bottom: 2px solid rgba(99, 102, 241, 0.2);
    }

    .section-title i {
        color: #6366f1;
        margin-right: 0.5rem;
    }

    .table-card {
        background: white;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        margin-bottom: 2rem;
        animation: fadeIn 0.6s ease backwards;
    }

    .table-card:nth-of-type(2) { animation-delay: 0.2s; }
    .table-card:nth-of-type(3) { animation-delay: 0.3s; }

    .table {
        margin: 0;
    }

    .table thead th {
        background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(16, 185, 129, 0.1) 100%);
        border: none;
        color: #1e293b;
        font-weight: 700;
        padding: 1.2rem;
        text-transform: uppercase;
        font-size: 0.85rem;
        letter-spacing: 0.5px;
    }

    .table tbody td {
        padding: 1.2rem;
        border-color: #e2e8f0;
        color: #64748b;
    }

    .table tbody tr {
        transition: all 0.3s ease;
        border-bottom: 1px solid #e2e8f0;
    }

    .table tbody tr:hover {
        background: #f8fafc;
        transform: scale(1.01);
    }

    .badge {
        padding: 0.5rem 1rem;
        border-radius: 8px;
        font-weight: 600;
        font-size: 0.85rem;
    }

    .badge-primary {
        background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(99, 102, 241, 0.1) 100%);
        color: #4f46e5;
    }

    .btn-sm {
        padding: 0.5rem 0.9rem;
        font-weight: 600;
        font-size: 0.85rem;
        border-radius: 8px;
        transition: all 0.3s ease;
        border: none;
        cursor: pointer;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
    }

    .btn-info {
        background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(99, 102, 241, 0.1) 100%);
        color: #4f46e5;
    }

    .btn-info:hover {
        background: linear-gradient(135deg, rgba(99, 102, 241, 0.3) 0%, rgba(99, 102, 241, 0.2) 100%);
        color: #4f46e5;
    }

    .btn-danger {
        background: linear-gradient(135deg, rgba(239, 68, 68, 0.2) 0%, rgba(239, 68, 68, 0.1) 100%);
        color: #dc2626;
    }

    .btn-danger:hover {
        background: linear-gradient(135deg, rgba(239, 68, 68, 0.3) 0%, rgba(239, 68, 68, 0.2) 100%);
        color: #dc2626;
    }

    .chart-container {
        background: white;
        border-radius: 15px;
        padding: 2rem;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        margin-bottom: 2rem;
        animation: fadeIn 0.6s ease 0.2s backwards;
    }

    .chart-container h3 {
        font-size: 1.3rem;
        font-weight: 700;
        margin-bottom: 1.5rem;
        color: #1e293b;
    }

    @keyframes slideInDown {
        from {
            opacity: 0;
            transform: translateY(-20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes slideInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
        }
        to {
            opacity: 1;
        }
    }
</style>

<div class="dashboard-header">
    <h1><i class="fas fa-chart-line"></i> Admin Dashboard</h1>
</div>

<div class="stats-grid">
    <div class="stat-card">
        <h5><i class="fas fa-users"></i> Total Users</h5>
        <div class="stat-number">{{ users|length }}</div>
    </div>
    <div class="stat-card">
        <h5><i class="fas fa-calendar-alt"></i> Total Events</h5>
        <div class="stat-number">{{ events|length }}</div>
    </div>
</div>

<div class="chart-container">
    <h3><i class="fas fa-bar-chart"></i> Event Registrations</h3>
    <canvas id="registrationChart" height="80"></canvas>
</div>

<div class="section-title">
    <i class="fas fa-users-cog"></i> Manage Users
</div>

<div class="table-card">
    <div class="table-responsive">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Username</th>
                    <th>Email</th>
                    <th>Role</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for user in users %}
                <tr>
                    <td><strong>#{{ user.id }}</strong></td>
                    <td>{{ user.username }}</td>
                    <td>{{ user.email }}</td>
                    <td><span class="badge badge-primary">{{ user.role }}</span></td>
                    <td>
                        <form action="{{ url_for('dashboard.delete_user', user_id=user.id) }}" method="POST" class="d-inline" onsubmit="return confirm('Are you sure? This action cannot be undone.');">
                            <button type="submit" class="btn-sm btn-danger">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div class="section-title">
    <i class="fas fa-calendar-check"></i> Manage Events
</div>

<div class="table-card">
    <div class="table-responsive">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Title</th>
                    <th>Location</th>
                    <th>Event Date</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for event in events %}
                <tr>
                    <td><strong>#{{ event.id }}</strong></td>
                    <td><strong>{{ event.title }}</strong></td>
                    <td>{{ event.location }}</td>
                    <td>{{ event.event_date.strftime('%b %d, %Y â€¢ %I:%M %p') }}</td>
                    <td>
                        <a href="{{ url_for('events.edit_event', event_id=event.id) }}" class="btn-sm btn-info">
                            <i class="fas fa-edit"></i> Edit
                        </a>
                        <form action="{{ url_for('events.delete_event', event_id=event.id) }}" method="POST" class="d-inline" onsubmit="return confirm('Are you sure? This action cannot be undone.');">
                            <button type="submit" class="btn-sm btn-danger">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
    const labels = {{ chart_labels|tojson }};
    const data = {{ chart_data|tojson }};
    const ctx = document.getElementById('registrationChart').getContext('2d');
    
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Registrations',
                data: data,
                backgroundColor: 'rgba(99, 102, 241, 0.6)',
                borderColor: 'rgba(99, 102, 241, 1)',
                borderWidth: 2,
                borderRadius: 8,
                borderSkipped: false,
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
                legend: {
                    display: true,
                    labels: {
                        font: { size: 12, weight: 'bold' },
                        color: '#64748b'
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: { stepSize: 1, color: '#94a3b8' },
                    grid: { color: 'rgba(99, 102, 241, 0.1)' }
                },
                x: {
                    ticks: { color: '#94a3b8' },
                    grid: { display: false }
                }
            }
        }
    });
</script>
{% endblock %}
